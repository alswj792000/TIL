# Promise

ì„¹ì…˜: HTTP í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬-axios
ìˆ˜ê°•ì¼: 2022ë…„ 9ì›” 22ì¼
ì§„í–‰ë„: 1

[ìë°”ìŠ¤í¬ë¦½íŠ¸ Promise ì‰½ê²Œ ì´í•´í•˜ê¸°](https://joshua1988.github.io/web-development/javascript/promise-for-beginners/)

---

# Promise

<aside>
ğŸ’¡ **â€œA promise is an object that may produce a single value some time in the futureâ€**
í”„ë¡œë¯¸ìŠ¤ëŠ” ë¯¸ë˜ì˜ ì–´ëŠ ì‹œì ì—ì„œ ë‹¨ì¼ ê°’ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê°ì²´ì´ë‹¤.

</aside>

ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¹„ë™ê¸° ì²˜ë¦¬ì— ì‚¬ìš©ë˜ëŠ” ê°ì²´ì´ë‹¤.

ì£¼ë¡œ ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œí• ë•Œ ì‚¬ìš©í•œë‹¤. 

---

# Promise ì½”ë“œ

ë‹¤ìŒì€ jqueryì˜ ajax í†µì‹  APIë¥¼ ì´ìš©í•´ ì§€ì •ëœ urlì—ì„œ 1ë²ˆ ìƒí’ˆ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ì½”ë“œë‹¤.

ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ `ì½œë°±í•¨ìˆ˜`ë¥¼ ì‚¬ìš©í–ˆë‹¤.

```jsx
function getData(callbackFunc) {
  $.get('url ì£¼ì†Œ/products/1', function(response) {
    callbackFunc(response); // ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„° responseë¥¼ callbackFunc() í•¨ìˆ˜ì— ë„˜ê²¨ì¤Œ
  });
}

getData(function(tableData) {
  console.log(tableData); // $.get()ì˜ response ê°’ì´ tableDataì— ì „ë‹¬ë¨
});
```

ìœ„ ì½”ë“œì— `í”„ë¡œë¯¸ìŠ¤`ë¥¼ ì ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```jsx
function getData(callback) {
  // new Promise() ì¶”ê°€
  return new Promise(function(resolve, reject) {
    $.get('url ì£¼ì†Œ/products/1', function(response) {
      // ë°ì´í„°ë¥¼ ë°›ìœ¼ë©´ resolve() í˜¸ì¶œ
      resolve(response);
    });
  });
}

// getData()ì˜ ì‹¤í–‰ì´ ëë‚˜ë©´ í˜¸ì¶œë˜ëŠ” then()
getData().then(function(tableData) {
  // resolve()ì˜ ê²°ê³¼ ê°’ì´ ì—¬ê¸°ë¡œ ì „ë‹¬ë¨
  console.log(tableData); // $.get()ì˜ reponse ê°’ì´ tableDataì— ì „ë‹¬ë¨
});
```

### âœ” Promiseì˜ 3ê°€ì§€ ìƒíƒœ(states)

í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í• ë•Œ ì•Œì•„ì•¼ í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ê°œë…ì´ë‹¤.

`í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœ`ë€ `í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ê³¼ì •`ì„ ì˜ë¯¸í•œë‹¤.

![Untitled](Promise%20cc624baf9f544b4dbf5f2687b9211093/Untitled.png)

`new Promise()`ë¡œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ì¢…ë£Œí• ë•Œê¹Œì§€ 3ê°€ì§€ ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤.

- `Pending(ëŒ€ê¸°)` : ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ì´ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ìƒíƒœ. ì´í–‰ë„ ê±°ë¶€ë„ ì•„ë‹Œ ì´ˆê¸° ìƒíƒœ
- `Fulfilled(ì´í–‰)` : ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì–´ í”„ë¡œë¯¸ìŠ¤ê°€ ê²°ê³¼ ê°’ì„ ë°˜í™˜í•´ì¤€ ìƒíƒœ. ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŒì„ ì˜ë¯¸
- `Rejected(ì‹¤íŒ¨)` : ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì‹¤íŒ¨í•˜ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ìƒíƒœ

### âœ” Pending(ëŒ€ê¸°)

`new Promise()`ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ëŒ€ê¸°(Pending) ìƒíƒœê°€ ëœë‹¤.

```jsx
new Promise();
```

`new Promise()`ë©”ì„œë“œë¥¼ í˜¸ì¶œí• ë•Œ ì½œë°± í•¨ìˆ˜ë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆê³ , ì½œë°± í•¨ìˆ˜ì˜ ì¸ìëŠ” `resolve`, `reject`ì´ë‹¤.

```jsx
new Promise(function(resolve, reject) {
  // ...
});
```

### âœ” Fulfilled(ì´í–‰)

ì½œë°± í•¨ìˆ˜ì˜ ì¸ì `resolve`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰í•˜ë©´ ì´í–‰(Fulfillled) ìƒíƒœê°€ ëœë‹¤.

í”„ë¡œë¯¸ìŠ¤ì˜ `ì´í–‰` ìƒíƒœëŠ” `ì™„ë£Œ`ìƒíƒœë¡œ ë³¼ìˆ˜ë„ ìˆë‹¤.

```jsx
new Promise(function(resolve, reject) {
  resolve();
});
```

ì´í–‰ ìƒíƒœê°€ ë˜ë©´ `then()`ì„ ì´ìš©í•´ ì²˜ë¦¬ ê²°ê³¼ ê°’ì„ ë°›ì„ìˆ˜ ìˆë‹¤.

```jsx
function getData() {
  return new Promise(function(resolve, reject) {
    var data = 100;
    resolve(data);
  });
}

// resolve()ì˜ ê²°ê³¼ ê°’ dataë¥¼ resolvedDataë¡œ ë°›ìŒ
getData().then(function(resolvedData) {
  console.log(resolvedData); // 100
});
```

### âœ” Rejected(ì‹¤íŒ¨)

`new Promise()`ë¡œ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ ìƒì„±ì‹œ ì½œë°± í•¨ìˆ˜ ì¸ìë¡œ `resolve`ì™€ `reject`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì´ì¤‘ rejectë¥¼ í˜¸ì¶œí•˜ë©´ ì‹¤íŒ¨(Rejected)ìƒíƒœê°€ ëœë‹¤.

```jsx
new Promise(function(resolve, reject) {
  reject();
});

// reject()ì˜ ê²°ê³¼ ê°’ Errorë¥¼ errì— ë°›ìŒ
getData().then().catch(function(err) {
  console.log(err); // Error: Request is failed
});
```

ì‹¤íŒ¨ìƒíƒœê°€ ë˜ë©´ ì‹¤íŒ¨í•œ ì´ìœ (ì‹¤íŒ¨ ì²˜ë¦¬ì˜ ê²°ê³¼ ê°’)ì„ `catch()`ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.

### âœ” í”„ë¡œë¯¸ìŠ¤ ì½”ë“œ ì˜ˆì œ

```jsx
function getData() {
	return new Promise(function(resolve, reject) { // 1. í”„ë¡œë¯¸ìŠ¤ ìƒì„± : Pending(ëŒ€ê¸°)ìƒíƒœ
		$.get('url ì£¼ì†Œ/products/1', function(response) {
		if (response) {
			resolve(response); // 2-1. Fulfilled(ì´í–‰)ìƒíƒœ
		}
		reject(new Error("Request is failed"));  // 3-1. Rejected(ì‹¤íŒ¨) ìƒíƒœ
		});
	});
}

// ìœ„ $.get() í˜¸ì¶œ ê²°ê³¼ì— ë”°ë¼ 'response' ë˜ëŠ” 'Error' ì¶œë ¥
getData().then(function(data) { // 2-2. Fulfilled(ì´í–‰)ìƒíƒœ â†’ resolveì˜ ì²˜ë¦¬ ê²°ê³¼ê°’ : data
	console.log(data); // response ê°’ ì¶œë ¥
}).catch(function(err) {  // 3-2. 3-1. Rejected(ì‹¤íŒ¨) ìƒíƒœ â†’ rejectì˜ ì‹¤íŒ¨ ì²˜ë¦¬ ê²°ê³¼ ê°’ : err
	console.error(err); // Error ì¶œë ¥
});
```

ì„œë²„ì—ì„œ ì œëŒ€ë¡œ ì‘ë‹µì„ ë°›ì•„ì˜¬ê²½ìš° `resolve()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³ , ì‘ë‹µì´ ì—†ìœ¼ë©´ `reject()`ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

í˜¸ì¶œëœ ë©”ì„œë“œì— ë”°ë¼ ì„±ê³µì‹œ `then()`ì„ í˜¸ì¶œí•˜ê³ , ì‹¤íŒ¨ì‹œ `catch()`ë¥¼ í˜¸ì¶œí•´ ì‘ë‹µ ê²°ê³¼ ë˜ëŠ” ì˜¤ë¥˜ë¥¼ ì¶œë ¥í•œë‹¤.

---

# ì—¬ëŸ¬ ê°œì˜ í”„ë¡œë¯¸ìŠ¤ ì—°ê²°í•˜ê¸° (Promise Chaining)

í”„ë¡œë¯¸ìŠ¤ëŠ” ì—¬ëŸ¬ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì—°ê²°í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

í”„ë¡œë¯¸ìŠ¤ê°€ ì„œë²„ì—ì„œ í†µì‹ ì´ ì„±ê³µí–ˆì„ë•Œ `then()`ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ë‚˜ë©´ ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ê°€ ë°˜í™˜ë˜ê¸°ë•Œë¬¸ì— ë°˜í™˜ëœ í”„ë¡œë¯¸ìŠ¤ëŠ” ë‹¹ì—°íˆ `.then()`ì„ í˜¸ì¶œí• ìˆ˜ìˆë‹¤.

```jsx
function getData() {
  return new Promise({
    // ...
  });
}

getData()
  .then(function(data) { // then() ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì—°ê²°í•œ í˜•ì‹
    // ...
  })
  .then(function() {
    // ...
  })
  .then(function() {
    // ...
  });
```

### âœ” í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì˜ˆì œ

```jsx
new Promise(function(resolve, reject){ // 1. 
  setTimeout(function() { //2. resolve(1)
    resolve(1);
  }, 2000);
})
.then(function(result) { // 3.
  console.log(result); // = 1
  return result + 10; // â†’ return(11)
})
.then(function(result) {  // 4.
  console.log(result); // = 11 
  return result + 20;  // â†’ return(31)
})
.then(function(result) { // 5.
  console.log(result); // 6. = 31
});
```

![Untitled](Promise%20cc624baf9f544b4dbf5f2687b9211093/Untitled%201.png)

ìœ„ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì§„í–‰ëœë‹¤.

1. í”„ë¡œë¯¸ìŠ¤ ê°ì²´ `new Promise()`ë¥¼ í•˜ë‚˜ ìƒì„±
2. `setTimeout()`ì„ ì´ìš©í•´ 2ì´ˆí›„ì— `resolve()`ë¥¼ í˜¸ì¶œ
3. `resolve()`í˜¸ì¶œì‹œ í”„ë¡œë¯¸ìŠ¤ê°€ **ëŒ€ê¸° â†’ ì´í–‰** ìƒíƒœë¡œ ë„˜ì–´ê°€ê¸°ë•Œë¬¸ì— ì²«ë²ˆì§¸ `.then()`ìœ¼ë¡œ ë„˜ì–´ê°
4. ì²«ë²ˆì§¸ `.then()`ì—ì„œ ì´í–‰ëœ ê²°ê³¼ ê°’ì¸ 1ì„ ë°›ì•„ 10ì„ ë”í•œ í›„ ê·¸ ë‹¤ìŒ `.then()`ìœ¼ë¡œ ë„˜ê²¨ì¤Œ
5. ë‘ë²ˆì§¸ `.then()`ì—ì„œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì´ì „ ê²°ê³¼ê°’ì¸ 11ì„ ë°›ì•„ 20ì„ ë”í•´ ë‹¤ìŒ `.then()`ìœ¼ë¡œ ë„˜ê²¨ì¤Œ
6. ë§ˆì§€ë§‰ `.then()`ì—ì„œ ìµœì¢… ê²°ê³¼ê°’ 31ì„ ì¶œë ¥

### âœ” í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì˜ˆì œ : ë¡œê·¸ì¸ ì¸ì¦ ë¡œì§

ë‹¤ìŒì€ í˜ì´ì§€ì— ì…ë ¥ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ì•„ì™€ íŒŒì‹±, ì¸ì¦ë“±ì˜ ì‘ì—…ì„ ê±°ì¹˜ëŠ” ì½”ë“œì´ë‹¤. 

ì—¬ëŸ¬ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ `.then()`ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```jsx
getData(userInfo) // ì‚¬ìš©ì ì •ë³´ê°€ ë‹´ê¸´ ê°ì²´
	// í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” í•¨ìˆ˜
  .then(parseValue)
  .then(auth)
  .then(diaplay);

// í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹
var userInfo = {
  id: 'test@abc.com',
  pw: '****'
};

function parseValue() {
  return new Promise({ // 1.
    // ...
  });
}
function auth() {
  return new Promise({
    // ...
  });
}
function display() {
  return new Promise({
    // ...
  });
}
```

---

# Promise ì—ëŸ¬ ì²˜ë¦¬ ë°©ë²•

### âœ” then()ì˜ ë‘ë²ˆì§¸ ì¸ìë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬

```jsx
getData().then(
  handleSuccess,
  handleError
);
```

### âœ” catch()ë¥¼ ì´ìš©

```jsx
getData().then().catch();
```

í”„ë¡œë¯¸ìŠ¤ ì—ëŸ¬ ì²˜ë¦¬ ë°©ë²•ë“¤ì€ í”„ë¡œë¯¸ìŠ¤ì˜ `reject()` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ ì‹¤íŒ¨ ìƒíƒœê°€ ëœ ê²½ìš°ì— ì‹¤í–‰ëœë‹¤.

ì¦‰, í”„ë¡œë¯¸ìŠ¤ì˜ ë¡œì§ì´ ì •ìƒì ìœ¼ë¡œ ëŒì•„ê°€ì§€ ì•ŠëŠ” ê²½ìš° í˜¸ì¶œëœë‹¤.

```jsx
function getData() {
  return new Promise(function(resolve, reject) {
    reject('failed');
  });
}

// 1. then()ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ
getData().then(function() {
  // ...
}, function(err) {
  console.log(err);
});

// 2. catch()ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ
getData().then().catch(function(err) {
  console.log(err);
});
```

í”„ë¡œë¯¸ìŠ¤ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë‘ê°€ì§€ ë°©ë²•ì¤‘, ê°€ê¸‰ì  `catch()`ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ”ê²ƒì´ ë” íš¨ìœ¨ì ì´ë‹¤.

**then()ì˜ ë‘ë²ˆì§¸ ì¸ìë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°**ì—ëŠ” `getData()`í•¨ìˆ˜ì˜ í”„ë¡œë¯¸ìŠ¤ì—ì„œ `resolve()`ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ì •ìƒì ìœ¼ë¡œ ë¡œì§ì„ ì²˜ë¦¬í–ˆìŒì—ë„ `.then()` ì²«ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²½ìš°ì˜ ì˜¤ë¥˜ë¥¼ ì œëŒ€ë¡œ ì¡ì•„ë‚´ì§€ ëª»í•œë‹¤.

ë”°ë¼ì„œ **[Uncatcht Error(ì—ëŸ¬ë¥¼ ì¡ì§€ ëª»í–ˆìŠµë‹ˆë‹¤)](https://joshua1988.github.io/images/posts/web/javascript/then-not-handling-error.png)** ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

í•˜ì§€ë§Œ **catch()ë¥¼ ì‚¬ìš©í•´ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°**ì—ëŠ” ë°œìƒí•œ ì—ëŸ¬ë¥¼ [ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬](https://joshua1988.github.io/images/posts/web/javascript/catch-handling-error.png)í•  ìˆ˜ ìˆë‹¤.

**ë”°ë¼ì„œ, ë” ë§ì€ ì˜ˆì™¸ ì²˜ë¦¬ ìƒí™©ì„ ìœ„í•´ í”„ë¡œë¯¸ìŠ¤ì˜ ëì— ê°€ê¸‰ì  catch()ë¥¼ ë¶™ì—¬ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤.**

---

# References.

[Promise - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)

[í”„ë¼ë¯¸ìŠ¤ ì²´ì´ë‹](https://ko.javascript.info/promise-chaining)

[Promise - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)